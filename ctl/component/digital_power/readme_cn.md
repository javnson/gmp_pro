# GMP CTL DP数字电源模块库说明文档

## 简介

本文档是 **数字电源控制模块库** 的官方说明和使用指南。该库旨在为电力电子工程师和嵌入式开发者提供一套功能强大、易于移植、高度模块化的固件工具集。通过封装常见的电源拓扑控制算法、高级并网策略、保护机制及硬件接口，本库能够显著加速从仿真到产品原型的开发进程。

### 设计理念

- **模块化**: 每个功能（如PID、PLL、MPPT）都是一个独立的组件，方便用户根据需求自由组合。
- **可移植性**: 核心算法与硬件抽象层分离，便于在不同微控制器（MCU）平台上进行移植。
- **高性能**: 算法兼顾了理论的严谨性和嵌入式环境下的实时性能。

### 库结构概览

该库主要包含以下五个核心子模块：

- **1. Basic 基础模块**: 提供构成复杂系统的基础单元，包括经典DC/DC变换器控制、通用保护策略和仿真接口。
- **2. MPPT 太阳能最大功率点跟踪模块**: 提供用于光伏（PV）发电系统的高效MPPT算法。
- **3. 单相变流器模块**: 提供用于单相并网逆变器、有源前端（AFE）、PFC整流器等场景的控制与调制算法。
- **4. 三相变流器模块**: 提供用于三相并网逆变器、电机驱动等场景的、基于d-q解耦的先进控制与调制算法。
- **5. 硬件预设模块**: 为特定的硬件平台提供预设的传感器校准参数，实现应用层代码与硬件参数的解耦。

## 1. Basic 基础模块

`Basic`子模块是整个库的基石，它包含了一系列基本电源拓扑的控制功能和通用组件。

- **1.1 Buck/Boost变换器控制器 (`buck.h`, `boost.h`)**
  - **功能**: 为经典的Buck和Boost电路提供通用的 **电压外环、电流内环双闭环PID控制器**。这种控制结构是实现高动态性能和精确稳态输出的标准方案。
  - **特点**: 支持电压、电流、开环等多种工作模式，用户可根据应用需求（如恒压输出、恒流充电）灵活切换。
- **1.2 四开关Buck-Boost占空比预设 (`buckboost.h`)**
  - **功能**: 为需要宽范围电压调节的 **四开关非反相Buck-Boost变换器** 提供占空比计算策略。
  - **特点**: 通过精巧的四区域划分，实现了从Buck到Boost模式的平滑无缝过渡。
- **1.3 通用保护策略 (`protection_strategy.h`)**
  - **功能**: 提供标准的 **“砖墙式”保护** 方案，能同时监测输出电压、电流和功率。
  - **特点**: 当任何一个参数超过设定的安全阈值时，会立即触发一个可锁存的错误标志，为系统提供基础且可靠的硬件保护。
- **1.4 软件在环(SIL)仿真接口 (`std_sil_dp_interface.h`)**
  - **功能**: 定义了用于 **软件在环（SIL）** 仿真的标准数据接口。
  - **特点**: 通过`#pragma pack(1)`强制数据结构1字节对齐，确保控制器固件能与Matlab/Simulink等仿真环境无缝对接，是实现模型化开发（MDD）的关键环节。

## 2. MPPT 太阳能最大功率点跟踪模块

`MPPT`子模块专为光伏发电系统设计，旨在实时追踪光伏电池的最大功率点，从而最大化能量捕获效率。

- **2.1 扰动观察法 (P&O) (`PnO_algorithm.h`)**
  - **原理**: 通过周期性地微小改变光伏面板的工作电压，并观察其输出功率的变化方向，来迭代寻找最大功率点。
  - **特点**: 实现了一个带 **自适应步长** 的高级P&O算法。在光照变化剧烈时采用大步长快速跟踪，在最大功率点附近则采用小步长减少稳态振荡，兼顾了动态响应和稳态效率。
- **2.2 电导增量法 (INC) (`INC_algorithm.h`)**
  - **原理**: 基于`dP/dV=0`在最大功率点的数学特性，通过比较电导增量(`dI/dV`)和瞬时电导(`-I/V`)的关系来精确判断工作点位置。
  - **特点**: 相比P&O法，INC法在理论上能更快速、准确地响应光照条件的突变，尤其适合天气多变的场合。

## 3. 单相变流器模块

`单相变流器模块`提供了一套完整的、用于单相AC/DC和DC/AC变换的控制算法，是实现单相PFC、并网逆变器、不间断电源（UPS）等应用的核心。

- **3.1 核心控制器 (`single_phase_dc_ac.h`)**
  - **架构**: 这是一个功能全面的单相变流器顶层控制器，内部集成了锁相、多模式控制和高级补偿算法。
  - **关键特性**:
    - **高次谐波补偿**: 采用 **准比例谐振（QPR/QR）控制器**，能对电网电流中的3, 5, 7...等多达15次的高次谐波进行精确补偿，显著提升输出电流的THD（总谐波失真）表现。
    - **多工作模式**: 支持开环、电流闭环、电压闭环等多种模式，并能配置为逆变或整流工作状态。
    - **精确AC测量**: 内置了基于`sine_analyzer`的真有效值（True RMS）计算模块，为闭环控制提供精确的反馈量。
- **3.2 单相锁相环 (SPLL) (`spll.h`)**
  - **架构**: 实现了一个基于 **二阶广义积分器（SOGI）** 的高性能单相锁相环。
  - **作用**: 在并网应用中，它能从充满谐波的电网电压中精确地提取出基波的相位和频率，是实现稳定并网和单位功率因数的前提。
- **3.3 其他组件**
  - **单相PFC控制器 (`spfc.h`)**: 为Boost型单相PFC整流器提供了一个简洁高效的双闭环控制器。
  - **单相调制 (`sp_modulation.h`)**: 实现了带 **死区补偿** 的单相单极性SPWM调制算法，有效减小了硬件死区带来的波形畸变。

## 4. 三相变流器模块

`三相变流器模块`基于现代交流控制理论，提供了一套功能极其丰富、性能卓越的控制算法，适用于三相并网逆变器、有源前端（AFE）、高性能电机驱动等多种复杂应用。

- **4.1 核心控制器 (`three_phase_dc_ac.h`)**
  - **架构**: 这是一个基于 **d-q同步旋转坐标系解耦控制** 的三相变流器顶层控制器，集成了业界前沿的多种高级控制策略。
  - **关键特性**:
    - **正负序双序控制**: 能够同时对电网的正序和负序分量进行独立控制。在电网电压不平衡时，能主动抑制负序电流，满足最严苛的并网导则要求。
    - **下垂控制 (Droop Control)**: 内置标准的P-f和Q-V下垂控制器，使逆变器不仅能并网运行，还能在离网/孤岛模式下稳定工作，并支持多机并联。
    - **多重谐波与零序补偿**: 在d-q旋转坐标系下精确补偿5、7次谐波，并对零序分量中的3、9次谐波进行抑制，全方位提升电能质量。
- **4.2 三相锁相环 (SRF-PLL) (`pll.h`)**
  - **架构**: 实现了一个标准的三相同步参考坐标系锁相环（SRF-PLL）。
  - **作用**: 这是三相系统中最经典、最可靠的锁相方法，为控制器提供高精度的电网同步信号。
- **4.3 其他组件**
  - **三相调制 (`tp_modulation.h`)**: 实现了带 **死区补偿** 的三相桥臂调制算法。
  - **三相维也纳整流器 (`Vienna.h`)**: 这是一个 **占位模块**，规划了未来将要实现的、用于高效率/大功率PFC场合的三相维也نا整流器控制器。

## 5. 硬件预设模块

`硬件预设模块`为特定的硬件平台提供预设的传感器校准参数。这种设计将底层硬件参数与上层控制算法完全解耦，使得算法代码无需修改即可复用于不同硬件。

将ADC读数转换为物理值的公式为：

- `物理电压值 = (ADC电压读数 - 电压偏置) / 电压增益`
- `物理电流值 = (ADC电压读数 - 电流偏置) / 电流增益`

下表列出了已支持的硬件平台的校准参数：

| 硬件方案 (Hardware Solution)          | 电压增益 (Voltage Gain) | 电压偏置 (Voltage Bias) | 电流增益 (Current Gain) | 电流偏置 (Current Bias) |
| ------------------------------------- | ----------------------- | ----------------------- | ----------------------- | ----------------------- |
| 点赛半桥v1板 (Diansai Half-Bridge v1) | `(2.2 / 202.2)`         | `0.9966 V`              | `(0.005 * 20.0)`        | `0.9 V`                 |
| ... (可继续扩充)                      | ...                     | ...                     | ...                     | ...                     |